{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ForecastResponse",
  "type": "object",
  "additionalProperties": false,
  "required": ["meta", "input", "topWindows", "byDomain", "summary"],
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["version", "granularity", "range"],
      "properties": {
        "version": { "type": "string" },
        "granularity": { "type": "string", "enum": ["month", "quarter"] },
        "range": {
          "type": "object",
          "additionalProperties": false,
          "required": ["from", "to"],
          "properties": {
            "from": { "type": "string", "pattern": "^\\d{4}-\\d{2}$" },
            "to": { "type": "string", "pattern": "^\\d{4}-\\d{2}$" }
          }
        },
        "as_of": { "type": "string", "format": "date" }
      }
    },
    "input": {
      "type": "object",
      "additionalProperties": false,
      "required": ["birth"],
      "properties": {
        "name": { "type": "string" },
        "birth": {
          "type": "object",
          "additionalProperties": false,
          "required": ["date", "time", "timezone", "location"],
          "properties": {
            "date": { "type": "string", "format": "date" },
            "time": {
              "type": "string",
              "pattern": "^([01]\\d|2[0-3]):[0-5]\\d(:[0-5]\\d)?$"
            },
            "timezone": { "type": "string" },
            "location": {
              "type": "object",
              "additionalProperties": false,
              "required": ["city", "region", "country", "lat", "lon"],
              "properties": {
                "city": { "type": "string" },
                "region": { "type": "string" },
                "country": { "type": "string" },
                "lat": { "type": "number", "minimum": -90, "maximum": 90 },
                "lon": { "type": "number", "minimum": -180, "maximum": 180 }
              }
            }
          }
        }
      }
    },
    "topWindows": {
      "type": "array",
      "items": { "$ref": "#/$defs/windowSummary" }
    },
    "byDomain": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "career",
        "relationships",
        "growth",
        "personality",
        "mind",
        "energy",
        "health",
        "money"
      ],
      "properties": {
        "career": { "type": "array", "items": { "$ref": "#/$defs/windowSummary" } },
        "relationships": { "type": "array", "items": { "$ref": "#/$defs/windowSummary" } },
        "growth": { "type": "array", "items": { "$ref": "#/$defs/windowSummary" } },
        "personality": { "type": "array", "items": { "$ref": "#/$defs/windowSummary" } },
        "mind": { "type": "array", "items": { "$ref": "#/$defs/windowSummary" } },
        "energy": { "type": "array", "items": { "$ref": "#/$defs/windowSummary" } },
        "health": { "type": "array", "items": { "$ref": "#/$defs/windowSummary" } },
        "money": { "type": "array", "items": { "$ref": "#/$defs/windowSummary" } }
      }
    },
    "summary": { "type": "array", "items": { "type": "string" } }
  },
  "$defs": {
    "windowSummary": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "windowId",
        "start",
        "end",
        "polarity",
        "intensity",
        "confidence",
        "themes",
        "systemsAligned",
        "evidenceCycleIds"
      ],
      "properties": {
        "windowId": { "type": "string" },
        "start": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
        "end": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
        "polarity": {
          "type": "string",
          "enum": ["supporting", "challenging", "neutral"]
        },
        "intensity": { "type": "number", "minimum": 0, "maximum": 1 },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "themes": { "type": "array", "items": { "type": "string" } },
        "systemsAligned": {
          "type": "array",
          "items": { "type": "string", "enum": ["western", "vedic", "chinese", "numerology"] }
        },
        "evidenceCycleIds": { "type": "array", "items": { "type": "string" } }
      }
    }
  }
}

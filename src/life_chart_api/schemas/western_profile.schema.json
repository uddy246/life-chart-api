{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "WesternAstrologyProfile",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "meta",
    "input",
    "chart",
    "identity",
    "planets",
    "houses",
    "aspects",
    "strengths",
    "transits",
    "predictions",
    "relationships",
    "career",
    "integratedSummary",
    "narrative"
  ],
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schemaVersion", "generatedAt", "engine", "locale"],
      "properties": {
        "schemaVersion": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$" },
        "generatedAt": { "type": "string", "format": "date-time" },
        "engine": {
          "type": "object",
          "additionalProperties": false,
          "required": ["name", "version"],
          "properties": {
            "name": { "type": "string" },
            "version": { "type": "string" }
          }
        },
        "locale": { "type": "string", "description": "BCP-47 locale, e.g. en-GB" }
      }
    },

    "input": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "birth"],
      "properties": {
        "name": { "type": "string" },
        "birth": {
          "type": "object",
          "additionalProperties": false,
          "required": ["date", "time", "timezone", "location"],
          "properties": {
            "date": { "type": "string", "format": "date" },
            "time": {
              "type": "string",
              "pattern": "^([01]\\d|2[0-3]):[0-5]\\d(:[0-5]\\d)?$",
              "description": "24h time; seconds optional"
            },
            "timezone": { "type": "string", "description": "IANA tz, e.g. Europe/London" },
            "location": {
              "type": "object",
              "additionalProperties": false,
              "required": ["city", "region", "country", "lat", "lon"],
              "properties": {
                "city": { "type": "string" },
                "region": { "type": "string" },
                "country": { "type": "string" },
                "lat": { "type": "number", "minimum": -90, "maximum": 90 },
                "lon": { "type": "number", "minimum": -180, "maximum": 180 }
              }
            }
          }
        }
      }
    },

    "chart": {
      "type": "object",
      "additionalProperties": false,
      "required": ["system", "zodiac", "houseSystem", "notes"],
      "properties": {
        "system": { "type": "string", "enum": ["western"] },
        "zodiac": { "type": "string", "enum": ["tropical"] },
        "houseSystem": {
          "type": "string",
          "enum": ["placidus", "wholeSign", "equal", "koch"],
          "description": "Match your engine; placidus is common."
        },
        "notes": { "type": "string" }
      }
    },

    "identity": {
      "type": "object",
      "additionalProperties": false,
      "required": ["sunSign", "moonSign", "ascendant", "coreSummary"],
      "properties": {
        "sunSign": { "$ref": "#/$defs/signPlacement" },
        "moonSign": { "$ref": "#/$defs/signPlacement" },
        "ascendant": { "$ref": "#/$defs/signPlacement" },
        "midheaven": { "$ref": "#/$defs/signPlacement" },
        "coreSummary": { "type": "string" }
      }
    },

    "planets": {
      "type": "array",
      "items": { "$ref": "#/$defs/planetPlacement" },
      "minItems": 10,
      "description": "At minimum Sun..Pluto; nodes optional but recommended."
    },

    "houses": {
      "type": "array",
      "items": { "$ref": "#/$defs/house" },
      "minItems": 12,
      "maxItems": 12
    },

    "aspects": {
      "type": "array",
      "items": { "$ref": "#/$defs/aspect" },
      "description": "Inter-planetary aspects; may be filtered to major aspects."
    },

    "strengths": {
      "type": "object",
      "additionalProperties": false,
      "required": ["planetary", "chartBalance", "dominantThemes"],
      "properties": {
        "planetary": {
          "type": "array",
          "items": { "$ref": "#/$defs/planetStrength" }
        },
        "chartBalance": {
          "type": "object",
          "additionalProperties": false,
          "required": ["elements", "modalities", "hemispheres"],
          "properties": {
            "elements": { "$ref": "#/$defs/balanceBuckets" },
            "modalities": { "$ref": "#/$defs/balanceBuckets" },
            "hemispheres": {
              "type": "object",
              "additionalProperties": false,
              "required": ["north", "south", "east", "west", "notes"],
              "properties": {
                "north": { "type": "number", "minimum": 0, "maximum": 100 },
                "south": { "type": "number", "minimum": 0, "maximum": 100 },
                "east": { "type": "number", "minimum": 0, "maximum": 100 },
                "west": { "type": "number", "minimum": 0, "maximum": 100 },
                "notes": { "type": "string" }
              }
            }
          }
        },
        "dominantThemes": { "type": "array", "items": { "type": "string" }, "minItems": 1 }
      }
    },

    "transits": {
      "type": "object",
      "additionalProperties": false,
      "required": ["referenceDate", "signals"],
      "properties": {
        "referenceDate": { "type": "string", "format": "date" },
        "signals": { "type": "array", "items": { "$ref": "#/$defs/timingSignal" } }
      }
    },

    "predictions": {
      "type": "object",
      "additionalProperties": false,
      "required": ["lifeAreas"],
      "properties": {
        "lifeAreas": { "type": "array", "items": { "$ref": "#/$defs/lifeAreaForecast" } }
      }
    },

    "relationships": {
      "type": "object",
      "additionalProperties": false,
      "required": ["style", "indicators", "riskFlags", "notes"],
      "properties": {
        "style": {
          "type": "object",
          "additionalProperties": false,
          "required": ["bonding", "conflict", "repair"],
          "properties": {
            "bonding": { "type": "string" },
            "conflict": { "type": "string" },
            "repair": { "type": "string" }
          }
        },
        "indicators": { "type": "array", "items": { "$ref": "#/$defs/indicator" } },
        "riskFlags": { "type": "array", "items": { "$ref": "#/$defs/riskFlag" } },
        "notes": { "type": "string" }
      }
    },

    "career": {
      "type": "object",
      "additionalProperties": false,
      "required": ["vectors", "bestEnvironments", "successFormula", "nearTermAdvice"],
      "properties": {
        "vectors": { "type": "array", "items": { "$ref": "#/$defs/careerVector" }, "minItems": 1 },
        "bestEnvironments": {
          "type": "array",
          "items": { "type": "string", "enum": ["structured", "fluid", "competitive", "collaborative", "independent"] }
        },
        "successFormula": { "type": "array", "items": { "type": "string" }, "minItems": 2 },
        "nearTermAdvice": { "type": "string" }
      }
    },

    "integratedSummary": {
      "type": "object",
      "additionalProperties": false,
      "required": ["convergences", "divergences", "bridgeTags"],
      "properties": {
        "convergences": { "type": "array", "items": { "$ref": "#/$defs/convergence" } },
        "divergences": { "type": "array", "items": { "$ref": "#/$defs/divergence" } },
        "bridgeTags": { "type": "array", "items": { "type": "string" } }
      }
    },

    "narrative": {
      "type": "object",
      "additionalProperties": false,
      "required": ["headline", "sections", "disclaimers"],
      "properties": {
        "headline": { "type": "string" },
        "sections": { "type": "array", "items": { "$ref": "#/$defs/narrativeSection" }, "minItems": 6 },
        "disclaimers": { "type": "array", "items": { "type": "string" }, "minItems": 1 }
      }
    }
  },

  "$defs": {
    "planet": {
      "type": "string",
      "enum": [
        "sun",
        "moon",
        "mercury",
        "venus",
        "mars",
        "jupiter",
        "saturn",
        "uranus",
        "neptune",
        "pluto",
        "northNode",
        "southNode",
        "chiron"
      ]
    },

    "sign": {
      "type": "string",
      "enum": [
        "aries",
        "taurus",
        "gemini",
        "cancer",
        "leo",
        "virgo",
        "libra",
        "scorpio",
        "sagittarius",
        "capricorn",
        "aquarius",
        "pisces"
      ]
    },

    "houseNumber": { "type": "integer", "minimum": 1, "maximum": 12 },

    "degreeInSign": { "type": "number", "minimum": 0, "exclusiveMaximum": 30 },

    "longitude": { "type": "number", "minimum": 0, "exclusiveMaximum": 360 },

    "signPlacement": {
      "type": "object",
      "additionalProperties": false,
      "required": ["sign", "degree"],
      "properties": {
        "sign": { "$ref": "#/$defs/sign" },
        "degree": { "$ref": "#/$defs/degreeInSign" }
      }
    },

    "planetPlacement": {
      "type": "object",
      "additionalProperties": false,
      "required": ["planet", "longitude", "sign", "degree", "house", "retrograde", "dignity", "notes"],
      "properties": {
        "planet": { "$ref": "#/$defs/planet" },
        "longitude": { "$ref": "#/$defs/longitude" },
        "sign": { "$ref": "#/$defs/sign" },
        "degree": { "$ref": "#/$defs/degreeInSign" },
        "house": { "$ref": "#/$defs/houseNumber" },
        "retrograde": { "type": "boolean" },
        "dignity": {
          "type": "object",
          "additionalProperties": false,
          "required": ["status", "note"],
          "properties": {
            "status": {
              "type": "string",
              "enum": ["domicile", "detriment", "exaltation", "fall", "neutral", "unknown"]
            },
            "note": { "type": "string" }
          }
        },
        "notes": { "type": "string" }
      }
    },

    "house": {
      "type": "object",
      "additionalProperties": false,
      "required": ["number", "sign", "planets", "themes", "notes"],
      "properties": {
        "number": { "$ref": "#/$defs/houseNumber" },
        "sign": { "$ref": "#/$defs/sign" },
        "planets": { "type": "array", "items": { "$ref": "#/$defs/planet" } },
        "themes": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        "notes": { "type": "string" }
      }
    },

    "aspectType": {
      "type": "string",
      "enum": ["conjunction", "sextile", "square", "trine", "opposition", "quincunx"]
    },

    "aspect": {
      "type": "object",
      "additionalProperties": false,
      "required": ["from", "to", "type", "orbDegrees", "strength", "note"],
      "properties": {
        "from": { "$ref": "#/$defs/planet" },
        "to": { "$ref": "#/$defs/planet" },
        "type": { "$ref": "#/$defs/aspectType" },
        "orbDegrees": { "type": "number", "minimum": 0, "maximum": 12 },
        "strength": { "type": "number", "minimum": 0, "maximum": 1 },
        "note": { "type": "string" }
      }
    },

    "planetStrength": {
      "type": "object",
      "additionalProperties": false,
      "required": ["planet", "overallScore", "band", "drivers"],
      "properties": {
        "planet": { "$ref": "#/$defs/planet" },
        "overallScore": { "type": "number", "minimum": 0, "maximum": 100 },
        "band": { "type": "string", "enum": ["low", "medium", "high"] },
        "drivers": { "type": "array", "items": { "$ref": "#/$defs/scoredFactor" }, "minItems": 1 }
      }
    },

    "balanceBuckets": {
      "type": "object",
      "additionalProperties": false,
      "required": ["low", "medium", "high", "notes"],
      "properties": {
        "low": { "type": "array", "items": { "type": "string" } },
        "medium": { "type": "array", "items": { "type": "string" } },
        "high": { "type": "array", "items": { "type": "string" } },
        "notes": { "type": "string" }
      }
    },

    "timingSignal": {
      "type": "object",
      "additionalProperties": false,
      "required": ["window", "signal", "confidence", "drivers", "note"],
      "properties": {
        "window": { "$ref": "#/$defs/timeWindow" },
        "signal": { "type": "string" },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "drivers": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        "note": { "type": "string" }
      }
    },

    "timeWindow": {
      "type": "object",
      "additionalProperties": false,
      "required": ["start", "end"],
      "properties": {
        "start": { "type": "string", "format": "date-time" },
        "end": { "type": "string", "format": "date-time" }
      }
    },

    "lifeAreaForecast": {
      "type": "object",
      "additionalProperties": false,
      "required": ["area", "outlook", "timingNotes", "actionableAdvice"],
      "properties": {
        "area": {
          "type": "string",
          "enum": ["self", "career", "money", "relationships", "family", "healthEnergy", "learning", "travel", "spirituality"]
        },
        "outlook": { "type": "string", "enum": ["supportive", "mixed", "testing"] },
        "timingNotes": { "type": "string" },
        "actionableAdvice": { "type": "string" }
      }
    },

    "indicator": {
      "type": "object",
      "additionalProperties": false,
      "required": ["key", "strength", "note"],
      "properties": {
        "key": { "type": "string" },
        "strength": { "type": "string", "enum": ["low", "medium", "high"] },
        "note": { "type": "string" }
      }
    },

    "riskFlag": {
      "type": "object",
      "additionalProperties": false,
      "required": ["key", "severity", "note"],
      "properties": {
        "key": { "type": "string" },
        "severity": { "type": "string", "enum": ["low", "medium", "high"] },
        "note": { "type": "string" }
      }
    },

    "careerVector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["label", "why", "supportingPlanets", "supportingHouses", "notes"],
      "properties": {
        "label": { "type": "string" },
        "why": { "type": "string" },
        "supportingPlanets": { "type": "array", "items": { "$ref": "#/$defs/planet" } },
        "supportingHouses": { "type": "array", "items": { "$ref": "#/$defs/houseNumber" } },
        "notes": { "type": "string" }
      }
    },

    "convergence": {
      "type": "object",
      "additionalProperties": false,
      "required": ["systems", "signal", "confidence", "note"],
      "properties": {
        "systems": {
          "type": "array",
          "items": { "type": "string", "enum": ["western", "vedic", "chinese", "numerology"] },
          "minItems": 2
        },
        "signal": { "type": "string" },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "note": { "type": "string" }
      }
    },

    "divergence": {
      "type": "object",
      "additionalProperties": false,
      "required": ["systems", "signal", "note"],
      "properties": {
        "systems": {
          "type": "array",
          "items": { "type": "string", "enum": ["western", "vedic", "chinese", "numerology"] },
          "minItems": 2
        },
        "signal": { "type": "string" },
        "note": { "type": "string" }
      }
    },

    "narrativeSection": {
      "type": "object",
      "additionalProperties": false,
      "required": ["key", "title", "body", "bullets"],
      "properties": {
        "key": { "type": "string" },
        "title": { "type": "string" },
        "body": { "type": "string" },
        "bullets": { "type": "array", "items": { "type": "string" } }
      }
    },

    "scoredFactor": {
      "type": "object",
      "additionalProperties": false,
      "required": ["key", "score", "note"],
      "properties": {
        "key": { "type": "string" },
        "score": { "type": "number", "minimum": -1, "maximum": 1 },
        "note": { "type": "string" }
      }
    }
  }
}
